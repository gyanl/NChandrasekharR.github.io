<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
  <title>Chandra Ramanujan</title>
  <meta property="og:title" content="Chandra Ramanujan" />
  <meta name="author" content="Chandra Ramanujan" />
  <meta property="og:locale" content="en_US" />
  <meta name="description" content="Chandra's blog" />
  <meta property="og:site_name" content="Chandra Ramanujan" />
  <meta name="twitter:card" content="summary" />
  <meta property="twitter:title" content="Chandra Ramanujan" />
  <!-- End Jekyll SEO tag -->

  <link rel="shortcut icon" type="image/x-icon" href="assets/favicon.ico">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="site-header">
    <div class="wrapper">
      <a class="site-title" rel="author" href="/">Chandra Ramanujan</a>
      <nav class="site-nav">
        <!-- <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label> -->
        <!-- <div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/archive">Archive</a><a class="page-link" href="/tag/branding">Branding</a><a class="page-link" href="/categories">Categories</a><a class="page-link" href="/tag/code">Code Experiments</a><a class="page-link" href="/tag/dataviz">Data Visualization</a><a class="page-link" href="/tag/fonts">Type Design</a><a class="page-link" href="/tag/food">Food &amp; Recipes</a><a class="page-link" href="/tag/idc">IDC School of Design</a><a class="page-link" href="/tag/internships">Internships</a><a class="page-link" href="/tag/misc">Miscellaneous</a><a class="page-link" href="/now">What am I doing these days?</a><a class="page-link" href="/tag/sketchnotes">Sketch Notes</a><a class="page-link" href="/tag/slides">Presentations</a><a class="page-link" href="/tag/uiux">UI/UX Projects</a><a class="page-link" href="/tag/website">Websites</a><a class="page-link" href="/writing">Writing</a></div> -->
        <div class="social-links desktop-only">

        </div>
      </nav>
    </div>
  </header>
  <main class="page-content" aria-label="Content">
    <div class="wrapper">
      <article id="pageContent" class="post h-entry displaynone animated fadeInUp" itemscope itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
          <h1 id="title" class="post-title p-name" itemprop="name headline">
            <span id="htmlTitle" >Loading...</span>
          </h1>
          <div id="htmlSubtitle" class="sub-title">This should work if you give it a second.</div>
        </header>
        <div id="htmlBody" class="post-content e-content" itemprop="articleBody">
        </div>
      </article>
      <script src="https://gyanl.com/assets/pell.js"></script>
      <script type="text/javascript">
    

        // Initialize pell on an HTMLElement
    pell.init({
      // <HTMLElement>, required
      element: document.getElementById('htmlBody'),
  
      // <Function>, required
      // Use the output html, triggered by element's `oninput` event
      onChange: html => console.log(html),
  
      // <string>, optional, default = 'div'
      // Instructs the editor which element to inject via the return key
      defaultParagraphSeparator: 'p',
  
      // <boolean>, optional, default = false
      // Outputs <span style="font-weight: bold;"></span> instead of <b></b>
      styleWithCSS: false,
  
      // <Array[string | Object]>, string if overwriting, object if customizing/creating
      // action.name<string> (only required if overwriting)
      // action.icon<string> (optional if overwriting, required if custom action)
      // action.title<string> (optional)
      // action.result<Function> (required)
      // Specify the actions you specifically want (in order)
      actions: [
        'bold',
        'italic',
        'underline',
        'heading1',
        'heading2',
        'heading3',
        'heading4',
        'paragraph',
        'olist',
        'ulist',
        'todo'
      ],
  
      // classes<Array[string]> (optional)
      // Choose your custom class names
      classes: {
        actionbar: 'pell-actionbar',
        button: 'pell-button',
        content: 'pell-content',
        selected: 'pell-button-selected'
      }
    })
  
      </script>
      <script type="module">

      // Get pageName = gyanl.com/string
      var pageName = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
      console.log(pageName);
  
      // Import the functions needed from the Firebase SDKs
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-analytics.js";
      import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js";
      import { getAuth, signInWithRedirect, getRedirectResult, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";
  
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
  
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  
      const firebaseConfig = {
        apiKey: "AIzaSyCrYHfMLzFwXtYucOzkVEEvXhywnT53cWE",
        authDomain: "chandrafun-fcc62.firebaseapp.com",
        databaseURL: "https://chandrafun-fcc62-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "chandrafun-fcc62",
        storageBucket: "chandrafun-fcc62.appspot.com",
        messagingSenderId: "46457356879",
        appId: "1:46457356879:web:acecdd6ad80d947b8a203a",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getDatabase();
      const provider = new GoogleAuthProvider();
      const auth = getAuth();
      const user = auth.currentUser;
  
      const reference = ref(db, 'posts/' + pageName);
  
      var vtitle = document.getElementById('htmlTitle');
      var vsubtitle = document.getElementById('htmlSubtitle');
      var vbody = document.getElementsByClassName("pell-content")[0];
      var vlogin = document.getElementById("logmein");
  
      var vdisplayname = "";
      var vphotourl = "";
      var vemail = "";
  
      var actionbar = document.getElementsByClassName("pell-actionbar")[0];
      
      // One time run
        onValue(reference, (snapshot) => {
  
      // If snapshot exists, get the values and populate the page.
          if (snapshot.exists()) {
            console.log(snapshot.val());
            vtitle.innerHTML = snapshot.val().title;
            vsubtitle.innerHTML = snapshot.val().subtitle;
            vbody.innerHTML = snapshot.val().body;
          } else {
          // If no snapshot, fill values and create record.
            console.log("Creating new record.");
            vtitle.innerHTML = pageName;
            vbody.innerHTML = "Write something epic.<br><br><br><br><br><br><br>";
            vbody.style.opacity = "0.5";
  
      // Create new log
            set(ref(db, 'posts/' + pageName), {
              title: vtitle.innerHTML,
              subtitle: vsubtitle.innerHTML,
              body : vbody.innerHTML
            });
          }
  
       // Stop showing loader and show content
          vbody.contentEditable = "false";
          document.getElementById("pageContent").classList.remove('displaynone');
        });
  
        // check if logged in
        hideActionBar();
        getUserDetails();
        
  
      function updateValues() {
        const updates = {};
        updates['posts/' + pageName + "/"] = {
          title: vtitle.innerHTML,
          subtitle: vsubtitle.innerHTML,
          body: vbody.innerHTML
        };
        update(ref(db), updates);
        console.log("Update sent");
      }
  
      function showActionBar() {
          actionbar.classList.remove("hidden");
          vbody.style.opacity = "1.0";
      }
  
      function hideActionBar() {
        actionbar.classList.add("hidden");
    }

      function signInUser() {
        console.log("Trying to sign in...")
        signInWithRedirect(auth, provider);
      }
  
      function showUserOnPage() {

        // Show user chip
        document.getElementById('containerOfUser').classList.remove('displaynone');
        document.getElementById('photoOfUser').src = vphotourl;
        document.getElementById('nameOfUser').innerHTML = vdisplayname;

        // Hide login button
        vlogin.classList.add('displaynone');

        if (vemail == "attnchand@gmail.com"){
          //User can edit, show edit access
          document.getElementById('statusOfUser').innerHTML = "Edit Access";
          
          // Make text areas editable
          vtitle.addEventListener("click", function() {
            vtitle.contentEditable = "true";
          });

          vsubtitle.addEventListener("click", function() {
            vsubtitle.contentEditable = "true";
          });

          vbody.contentEditable = "true";

          // Add event listeners for update values
          vtitle.addEventListener("blur", updateValues);
          vsubtitle.addEventListener("blur", updateValues);
          vbody.addEventListener("blur", updateValues);

          // Show action bar
          showActionBar();
        }

        else{
          //User read only, show read only access
          document.getElementById('statusOfUser').innerHTML = "Read Access";
        }
      }

      function getUserDetails() {
        console.log("Trying to get user details...");
  
        const auth = getAuth();

        getRedirectResult(auth)
          .then((result) => {
            // This gives you a Google Access Token. You can use it to access Google APIs.
            const credential = GoogleAuthProvider.credentialFromResult(result);
            const token = credential.accessToken;
        
            console.log(credential);
            console.log(token);
        
            // The signed-in user info.
            const user = result.user;
            console.log(user);
            console.log("i think you are " + user.displayName);
            vdisplayname = user.displayName;
            vphotourl = user.photoURL;
            vemail = user.email;
            showUserOnPage();
            
          }).catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            // The email of the user's account used.
            const email = error.email;
            // The AuthCredential type that was used.
            const credential = GoogleAuthProvider.credentialFromError(error);
            // ...
          });
  
      }


      // Add event listeners
      vlogin.addEventListener("click", signInUser);
      </script>
    </div>
  </main>


  <footer class="site-footer h-card">
    <data class="u-url" href="/">
    </data>
    <div class="wrapper">
      <div class="footer-col-wrapper">
        <div class="footer-col one-half">
          <h2 class="footer-heading">Chandra Ramanujan</h2>
          <ul class="contact-list">
            <p>Made with love, 2022</p>
          </ul>
        </div>
        <div class="footer-col one-half">
          <h2 class="footer-heading"></h2>
          <button class="loginbutton" type="button" id="logmein">Log in and Edit</button>
          <div class="logincontainer">
            <div id="containerOfUser" class="usercontainer displaynone">
              <img class="userphoto" src="" id="photoOfUser">
              <div class="vertical">
                <div class="username" id="nameOfUser">no name</div>
                <div class="userstatus" id="statusOfUser">Edit access</div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
</body>

</html>